<% @main_question = t("views.ctc.questions.legal_consent.title") %>

<% content_for :page_title, @main_question %>

<% content_for :card do %>
  <%= form_with model: @form, url: current_path, local: true, method: "put", builder: VitaMinFormBuilder, html: { class: "form-card form-card--long" } do |f| %>
    <h1 class="h2"><%= @main_question %></h1>

    <%= t("views.ctc.questions.legal_consent.body_html") %>

    <div class="form-card__content">
      <%= f.cfa_input_field(:primary_first_name, t("views.ctc.questions.legal_consent.first_name"), classes: ["form-width--long"]) %>
      <%= f.cfa_input_field(:primary_middle_initial, t("views.ctc.questions.legal_consent.middle_initial"), classes: ["form-width--short"]) %>
      <%= f.cfa_input_field(:primary_last_name, t("views.ctc.questions.legal_consent.last_name"), classes: ["form-width--long"]) %>
      <%= f.cfa_select(:primary_suffix, t("views.ctc.questions.legal_consent.suffix"), suffix_options_for_select, include_blank: true) %>
      <%= f.vita_min_date_text_fields(
            :primary_birth_date,
            t("hub.clients.show.date_of_birth"),
            help_text: t("hub.clients.show.date_of_birth_help"),
            classes: ["ctc-intake-date-text-input"]
            ) %>
      <%= f.cfa_select(:primary_tin_type, t('views.ctc.questions.legal_consent.form_of_identity'), tin_options_for_select(include_itin: true)) %>
      <%= f.cfa_input_field(:primary_ssn, t("views.ctc.questions.legal_consent.ssn"), classes: ["form-width--long"], options: { maxlength: 11, 'data-mask': '000-00-0000' }) %>
      <%= f.cfa_input_field(:primary_ssn_confirmation, t("views.ctc.questions.legal_consent.ssn_confirmation"), classes: ["form-width--long"], options: { maxlength: 11, 'data-mask': '000-00-0000' }) %>
      <%= f.cfa_checkbox(:ssn_no_employment, t('views.ctc.questions.legal_consent.primary_ssn_not_valid_for_employment'), options: { checked_value: "yes", unchecked_value: "no" }) %>
      <%= f.cfa_input_field(:phone_number, t("views.ctc.questions.legal_consent.sms_phone_number"), classes: ["form-width--long"]) %>
      <div class="tight-checkboxes">
        <%= f.cfa_checkbox(:primary_active_armed_forces, t("views.ctc.questions.legal_consent.primary_active_armed_forces", current_tax_year: MultiTenantService.new(:ctc).current_tax_year), options: { checked_value: "yes", unchecked_value: "no" }) %>
        <%= f.cfa_checkbox(:was_blind, t("views.ctc.questions.legal_consent.primary_was_blind", current_tax_year: MultiTenantService.new(:ctc).current_tax_year), options: { checked_value: "yes", unchecked_value: "no" }) %>
      </div>
      <%= recaptcha_v3(action: 'legal_consent') %>
    </div>

    <div class="spacing-below-60">
      <%= f.simplified_cfa_checkbox(
            :agree_to_privacy_policy,
            t("views.ctc.questions.legal_consent.agree_to_share_html", privacy_policy_link: ctc_privacy_path),
            options: { id: "agree_to_privacy_policy" }
          ) %>
    </div>

    <%= f.continue %>
  <% end %>
<% end %>

<% content_for :script do %>
  <script>
      document.addEventListener("DOMContentLoaded", function() {
        window.TINTypeSelector = document.getElementById("ctc_legal_consent_form_primary_tin_type");
        window.SSNEmploymentCheckboxSelector = document.getElementById("ctc_legal_consent_form_ssn_no_employment").parentElement;
      });
  </script>
<% end %>
