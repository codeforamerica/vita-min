<% @main_heading = "Session Toggles" %>
<% content_for :page_title, @main_heading %>
<% content_for :back_to, "admin_tools" %>

<% content_for :card do %>
  <div class="slab slab--half-padded">
    <div class="grid">
      <h1><%= @main_heading %></h1>
      <% unless Rails.env.production? %>
        <div class="form-card__content">
          <%= form_for(@toggle, url: { action: :create }, method: :post, local: true, builder: VitaMinFormBuilder, html: { class: "form-card form-card--long" }) do |f| %>
            <%= f.hidden_field :name %>
            <%=
              f.cfa_input_field(
                  :value,
                  "App time (Pacific)",
                  type: 'datetime-local',
                  options: {
                      value: f.object.value&.in_time_zone("America/Los_Angeles")&.strftime('%Y-%m-%dT%H:%M')
                  },
                  classes: ['form-width--long'],
                  )
            %>

            <button class="button button--cta spacing-above-0" type="submit">
              <%= t("general.save") %>
            </button>
            <button class="button button--cta spacing-above-0" type="submit" name="clear">
              <%= "Clear" %>
            </button>
          <% end %>
        </div>

        <hr class="spacing-above-5 spacing-below-15"/>
      <% end %>

      <p>Relevant times in this environment:</p>
      <span>(ğŸ›ï¸ means the past, ğŸ”® means the future)</span>
      <h4><%= link_to 'Get Your Refund', url_for(host: MultiTenantService.new(:gyr).host, controller: :session_toggles) %></h4>
      <ul class="list--bulleted">
        <% @gyr_times.each do |toggle_time| %>
          <li><%= toggle_time.past?(app_time) ? 'ğŸ›ï¸ï¸' : 'ğŸ”®' %> <%= toggle_time.name %>: <%= timestamp(toggle_time.value) %></li>
        <% end %>
      </ul>

      <h4><%= link_to 'GetCTC', url_for(host: MultiTenantService.new(:ctc).host, controller: :session_toggles) %></h4>
      <ul class="list--bulleted">
        <% @ctc_times.each do |toggle_time| %>
          <li><%= toggle_time.past?(app_time) ? 'ğŸ›ï¸' : 'ğŸ”®' %> <%= toggle_time.name %>: <%= timestamp(toggle_time.value) %></li>
        <% end %>
      </ul>
    </div>
  </div>
<% end %>
