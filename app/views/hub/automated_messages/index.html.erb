<% @main_heading = t(".title") %>
<% content_for :page_title, @main_heading %>

<% content_for :card do %>
  <div class="slab">
    <div class="grid">
      <div class="grid__item width-one-whole">
        <h1><%= @main_heading %></h1>

        <% @emails.each do |email_class, email| %>
          <h2>
            <%= email_class %>
          </h2>
          <div class="client-messages-container" style="display: flex;">
            <div class="with-padding-med" style="display: inline-block; width: 45%; margin-right: 16px; z-index: 3;">
              <div class="client-messages__email">
                <div class="email__subject">
                  <%= email.subject %>
                </div>
                <div>
                  <%= content_tag :iframe, nil, style: "width: 100%", sandbox: "allow-same-origin allow-scripts", srcdoc: email.html_part.body.decoded %>
                </div>
              </div>
            </div>
          </div>
        <% end %>

        <% @messages.each do |message| %>
          <h2>
            <%= message.class.name %>
          </h2>
          <div class="client-messages-container" style="display: flex;">
            <div class="with-padding-med" style="display: inline-block; width: 45%; margin-right: 16px; z-index: 3;">
              <div class="client-messages__email">
                <div class="email__subject">
                  <%= message.email_subject %>
                </div>
                <div style="white-space: pre-line;">
                  <%= message.email_body %>
                </div>
              </div>
            </div>
            <div class="with-padding-med" style="display: inline-block; width: 45%; margin-right: 8px;">
              <div class="client-messages__sms">
                <div style="white-space: pre-line;"><%= message.sms_body %></div>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  </div>
<% end %>
<% content_for :script do %>
  <script>
      function resizeIFrameToFitContent( iFrame ) {
          iFrame.height = iFrame.contentWindow.document.body.scrollHeight + 20;
      }
      document.querySelectorAll('iframe').forEach((iframe) => {
          iframe.addEventListener(("load"), function () {
              resizeIFrameToFitContent(iframe);
          })
      });
  </script>
<% end %>
