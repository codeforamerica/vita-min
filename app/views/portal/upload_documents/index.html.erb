<% content_for :title, t(".title") %>

<% content_for :card do %>
  <h1 class="h2"><%= t(".title") %></h1>

  <div class="document-overview-list">
    <% documents_by_type = @documents.group_by(&:document_type) %>
    <% document_type_keys.each do |type| %>
      <% documents = documents_by_type[type] || [] %>
      <% if type == DocumentTypes::Identity.key %>
        <% documents = DocumentTypes::IDENTITY_TYPES.map { |type| documents_by_type[type.key] || [] }.flatten %>
      <% end %>
      <% if type == DocumentTypes::SsnItin.key %>
        <% documents = DocumentTypes::SECONDARY_IDENTITY_TYPES.map { |type| documents_by_type[type.key] || [] }.flatten %>
      <% end %>

      <div id="<%= type.underscore %>-docs">
        <% if [DocumentTypes::Identity.key, DocumentTypes::SsnItin.key].include? type %>
          <span class="document-overview-list__icon">
            <%= image_tag "id-card.svg", alt: "", class: "" %>
          </span>
        <% elsif type == DocumentTypes::Selfie.key %>
          <span class="document-overview-list__icon">
            <%= image_tag "selfie.svg", alt: "", class: "" %>
          </span>
        <% else %>
          <span class="document-overview-list__icon">
            <%= image_tag "paper.svg", alt: "", class: "" %>
          </span>
        <% end %>
        <h2 class="h3 document-overview-list__item-text">
          <% if type == DocumentTypes::SsnItin.key && IdVerificationExperimentService.new(current_intake).show_expanded_id? %>
            <%= t("documents.overview.edit.additional_form_of_id") %>
          <% else %>
            <%= t(".document_types.#{type.parameterize(separator: "_")}") %>
          <% end %>
        </h2>

        <%= link_to t("general.add").downcase, portal_upload_documents_path(type: type), class: "button button--inline-action" %>

        <ul class="document-overview-list__filenames">
        <% if documents.empty? %>
            <% if type == DocumentTypes::Form1095A.key %>
              <li class="missing-data"><strong><%= t(".please_add_form1095A") %></strong></li>
            <% elsif type == DocumentTypes::Form1099R.key %>
              <li class="missing-data"><strong><%= t(".please_add_form1099R") %></strong></li>
            <% elsif type != DocumentTypes::Other.key %>
              <li class="missing-data"><strong><%= t(".please_add_document") %></strong></li>
            <% end %>
        <% end %>
        <% documents.each do |document| %>
          <li>
            <%= link_to document.upload.filename, portal_document_path(id: document.id), target: "_blank", rel: "noopener noreferrer" %>
          </li>
        <% end %>
      </ul>
      </div>
      <hr class="spacing-above-25 spacing-below-10">
    <% end %>
  </div>

  <div class="grid-flex center-justified center-aligned column-column">
    <%= image_tag "chat-bubble--blue.svg", alt: "", class: "document-overview-list__icon spacing-below-25" %>
    <strong><%= link_to t(".message_my_tax_team"), new_portal_message_path %></strong>
  </div>

<% end %>
